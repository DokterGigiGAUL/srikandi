<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SRIKANDI - Skrining Risiko Kanker Mulut: Digital</title>
    <link rel="icon" type="image/x-icon" href="/Logo-gigital-small.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  </head>

  <body class="bg-gray-100">
    <input type="file" id="fileInput" accept="image/*" class="hidden" />
    <div class="max-w-lg md:w-xl mx-auto min-h-screen bg-[linear-gradient(to_bottom,rgba(255,255,255,0.95),rgba(255,255,255,0.98)),url('https://live.staticflickr.com/65535/55111931235_97bf050cce_c.jpg')] bg-local bg-cover bg-center">
      <!-- Header with Logo -->
      <div class="flex items-center mx-auto justify-center bg-none mx-6 py-3 border-b border-gray-300">
        <!-- QR Logo -->
        <div class="w-8 h-auto rounded-lg mx-auto justify-center">
          <a href="https://doktergigigaul.github.io/srikandi">
          <img
            src="https://doktergigigaul.github.io/ocre/Logo-gigital-2.png"
          /></a>
        </div>
      </div>

      <!-- Main Content -->
      <div id="mainContent" class="mb-6 px-6 pt-4">
        <!-- Welcome Header -->
        <div id="welcomeHeader">
          <p class="text-sm text-gray-500 leading-loose tracking-[0.5em] uppercase">SRIKANDI</p>
          <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-3 -tracking-[0.062rem] leading-tight">Skrining Risiko Kanker Mulut Digital</h2>
        </div>
        <!-- Welcome Card -->
        <div id="welcomeScreen">
          <div class="mb-6">
            <p class="text-lg md:text-xl text-gray-700 mb-4 leading-snug">
              Bot berbasis AI untuk penilaian resiko malignansi dari gambar lesi
              rongga mulut.
            </p>
            <div class="w-full my-6">
              <img src="https://live.staticflickr.com/65535/55109807340_265f41c6e7_m.jpg" alt="Foto 1" class="w-full aspect-[3/2] object-cover rounded-2xl" />
            </div>
            
            <!-- Instructions -->
            <div class="space-y-3">
              <div class="flex items-start gap-2">
                <span class="">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-5 text-sky-600" fill="currentColor">
                <path d="M12 2C6.477 2 2 6.477 2 12c0 1.821.487 3.53 1.338 5L2 22l5-1.338c1.47.851 3.179 1.338 5 1.338 5.523 0 10-4.477 10-10S17.523 2 12 2z" />
                <circle cx="12" cy="8" r="1" fill="white" />
                <path d="M11 11h2v6h-2v-6z" fill="white" />
                </svg>
                </span>
                  <div class="text-normal leading-tight">
                    <p class="font-semibold text-gray-900">Cara Menggunakan:</p>
                  </div>
              </div>
              <ol class="text-normal text-gray-700 mt-2 pb-0 space-y-1 leading-tight list-decimal px-6">
                <li>Kirim foto lesi mulut yang jelas</li>
                <li>Tunggu proses analisis bot Srikandi</li>
                <li>Dapatkan probabilitas dan persentase hasil deteksi</li>
              </ol>
            </div>
          </div>

          <!-- Upload Button -->
          <div class="relative z-10 flex flex-col items-center mx-auto">
            <button onclick="document.getElementById('fileInput').click()"
              class="pulse-ring-pill transition-transform active:scale-95 justify-center mx-auto z-10 w-62% bg-sky-600 hover:bg-sky-500 text-white font-semibold py-4 px-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center gap-2"
            >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            <span class="text-lg font-bold">Ambil/ Upload Foto</span>
            </button>
            <p class="text-sm text-gray-400 my-3">
              Klik tombol di atas untuk memulai
            </p>
          </div>
            
          <!-- Warning Card -->
          <div class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-4 my-6">
            <div class="flex items-start gap-2">
            <span class="">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="24" >
                  <path d="M12 2L1 21h22L12 2z" fill="#FFD700" stroke="black" stroke-width="2" />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
              <ul class="text-sm text-gray-800 space-y-1 list-disc pl-4">
                <li>Hasil hanya untuk screening resiko awal, BUKAN pengganti diagnosis medis dokter gigi profesional</li>
                <li>Selalu konsultasi dengan dokter gigi spesialis penyakit mulut untuk diagnosis medis akhir</li>
                <li>Hanya untuk digunakan oleh tenaga medis profesional yang kompeten</li>
              </ul>
          </div>
        </div>
         
        <!-- Processing Screen -->
        <div id="processingScreen" class="hidden">
          <!-- Image Preview -->
          <div class="my-4">
            <img id="imagePreview" class="result-image" alt="Preview" />
          </div>
         <!-- Processing Status -->
          <div class="space-y-2">
            <button class="w-auto mx-auto flex items-center justify-center gap-2 px-6 py-4 rounded-xl bg-gray-500 hover:bg-gray-600 text-white">
              <svg class="animate-spin h-4 w-4 text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span class="text-lg font-bold">Menganalisis</span>
            </button>
            <p class="text-center text-sm text-gray-500">Harap menunggu... Terimakasih.</p>
          </div>

        <!-- Warning Card (repeated) -->

      <div class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-4 my-6">
        <div class="flex items-start gap-2">
          <span class="">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="24" >
              <path d="M12 2L1 21h22L12 2z" fill="#FFD700" stroke="black" stroke-width="2" />
              <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
            </svg>
          </span>
          <div>
            <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
          </div>
        </div>
        <ul class="text-sm text-gray-800 space-y-1 list-disc pl-4">
                <li>Hasil hanya untuk screening resiko awal, BUKAN pengganti diagnosis medis dokter gigi profesional</li>
                <li>Selalu konsultasi dengan dokter gigi spesialis penyakit mulut untuk diagnosis medis akhir</li>
                <li>Hanya untuk digunakan oleh tenaga medis profesional yang kompeten</li>
              </ul>
      </div>
        </div>
        <!-- Result Screen -->
        <div id="resultScreen" class="hidden">
          <!-- Result Image -->
          <div class="my-4 rounded-2xl z-9">
            <img id="resultImage" class="result-image" alt="Result" />
          </div>

          <!-- Result Status Card -->
          <div id="resultCard" class="relative -mt-24 z-10">
            <div class="text-left">
              <p class="text-md mb-1">
                <span class="font-bold">Probabilitas:</span>
                <span id="statusText" class="font-bold"></span>
              </p>
              <p class="text-md">
                <span class="font-base">Persentase:</span>
                <span id="confidenceText" class="font-base"></span>
              </p>
            </div>
          </div>
      

          <!-- Recommendation Card -->
          <div class="bg-none rounded-xl border-none mb-4">
            <p id="recommendationText" class="text-gray-900 leading-normal"></p>
          </div>
          
          <!-- New Analysis Button -->
          <button onclick="resetApp()" class="w-full mb-4 w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold p-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center mx-auto gap-3">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            <span class="text-lg">Penilaian resiko lesi baru</span>
          </button>
          
          <!-- Warning Card (repeated) -->
         <div class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-4 my-6">
          <div class="flex items-start gap-2">
            <span class="">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="12" height="24" >
                <path d="M12 2L1 21h22L12 2z" fill="#FFD700" stroke="black" stroke-width="2" />
                <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
              </svg>
            </span>
            <div>
              <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
            </div>
          </div>
          <ul class="text-sm text-gray-800 space-y-1 list-disc pl-4">
            <li>Hasil hanya untuk screening resiko awal, BUKAN pengganti diagnosis medis dokter gigi profesional</li> 
            <li>Selalu konsultasi dengan dokter gigi spesialis penyakit mulut untuk diagnosis medis akhir</li>
            <li>Hanya untuk digunakan oleh tenaga medis profesional yang kompeten</li>
          </ul>
        </div>
        </div>
        <!-- Copyright -->
        <div><p class="flex text-gray-400 items-center justify-center mx-auto text-xs">Copyright (c) Gigital - 2026</p></div> 
    <script>
              // Configuration
              const BACKEND_API_URL = 'https://script.google.com/macros/s/AKfycbzUWjjMNL4ZbTlSFz9lRBe44qXtsXtLaZpab5PMvwQVpCo9SXiB75LnpGVnAtMMnYPenA/exec';

              // AI Model Simulator
              class OralCancerDetector {
                  constructor() {
                      this.modelLoaded = false;
                  }

                  async loadModel() {
                      return new Promise(resolve => {
                          setTimeout(() => {
                              this.modelLoaded = true;
                              resolve();
                          }, 500);
                      });
                  }

                  async predict(imageData) {
                      const response = await fetch('https://web-production-ad57e.up.railway.app/predict', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ image: imageData })
                      });
                      const data = await response.json();
                      return {
                          probability: data.prediction_value,
                          confidence: data.confidence / 100,
                          isCancer: data.diagnosis === 'Cancer Detected'
                      };
                  }
              }

              const detector = new OralCancerDetector();
              let currentImage = null;

              // File Input Handler
              document.getElementById('fileInput').addEventListener('change', async (e) => {
                  const file = e.target.files[0];
                  if (file) {
                      await handleImageUpload(file);
                  }
              });

              async function handleImageUpload(file) {
                  if (file.size > 5 * 1024 * 1024) {
                      alert('Ukuran file terlalu besar! Maksimal 5MB');
                      return;
                  }

                  const reader = new FileReader();
                  reader.onload = async (e) => {
                      currentImage = e.target.result;

                      // Show processing screen
                      document.getElementById('welcomeScreen').classList.add('hidden');
                      document.getElementById('processingScreen').classList.remove('hidden');
                      document.getElementById('imagePreview').src = currentImage;

                      // Show processing status
                      setTimeout(() => {
                          document.getElementById('processingStatus').classList.remove('hidden');
                      }, 500);

                      // Load model if not loaded
                      if (!detector.modelLoaded) {
                          await detector.loadModel();
                      }

                      // Run prediction
                      const result = await detector.predict(currentImage);


                      // Upload to cloud (optional)
                      await uploadToCloud(currentImage, result);

                      // Show results
                      displayResults(result);
                  };
                  reader.readAsDataURL(file);
              }

              function displayResults(result) {
                  const percentage = (result.confidence * 100).toFixed(2);
                  const isCancer = result.isCancer;

                  // Hide processing, show result
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('resultScreen').classList.remove('hidden');
                  document.getElementById('resultImage').src = currentImage;

                  // Result card styling
                  const resultCard = document.getElementById('resultCard');
                  const statusText = document.getElementById('statusText');
                  const confidenceText = document.getElementById('confidenceText');
                  const recommendationText = document.getElementById('recommendationText');

                  if (isCancer) {
                      // KANKER MULUT
                      resultCard.className = 'relative -mt-28 z-10 rounded-b-xl px-6 py-6 mb-4 bg-red-600 text-white';
                      statusText.textContent = 'KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Penilaian mungkin menampilkan hasil false negative/ false positive karena AI masih dalam proses training. Segera jadwalkan konsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat untuk memastikan bahwa kondisi yang ada memang berpotensi keganasan';
                  } else {
                      // NON KANKER MULUT
                      resultCard.className = 'relative -mt-28 z-10 rounded-b-xl px-6 py-6 mb-4 bg-green-700 text-white';
                      statusText.textContent = 'NON KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Penilaian mungkin menampilkan hasil false negative/ false positive karena AI masih dalam proses training. Pastikan kondisi yang ada tidak berpotensi keganasan. Berkonsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat.';
                  }

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              function getConfidenceLevel(confidence) {
                  if (confidence >= 0.8) return 'Tinggi';
                  if (confidence >= 0.6) return 'Sedang';
                  return 'Rendah';
              }

              async function uploadToCloud(imageData, predictionResult) {
          try {
              const formData = new FormData();
              formData.append('file', imageData);
              formData.append('filename', 'oral_cancer.jpg');
              formData.append('mimeType', 'image/jpeg');
              formData.append('timestamp', new Date().toISOString());
              formData.append('age', '');
              formData.append('gender', '');
              formData.append('prediction', predictionResult ?
                  `${(predictionResult.probability * 100).toFixed(2)}% - ${predictionResult.isCancer ? 'Kanker' : 'Non-Kanker'}` :
                  'Unknown');

              const response = await fetch(BACKEND_API_URL, {
                  method: 'POST',
                  body: formData
              });

              const result = await response.json();
              console.log('Upload result:', result);

              return result;
          } catch (error) {
              console.warn('Upload failed:', error);
              return null;
          }
      }

              function resetApp() {
                  // Reset to welcome screen
                  document.getElementById('resultScreen').classList.add('hidden');
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('welcomeScreen').classList.remove('hidden');
                  document.getElementById('processingStatus').classList.add('hidden');

                  // Clear file input
                  document.getElementById('fileInput').value = '';
                  currentImage = null;

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              // Initialize
              detector.loadModel();
    </script>
  </body>
</html>
