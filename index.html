<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCRE - Oral Cancer Risk Evaluator</title>
<link rel="icon" type="image/x-icon" href="https://doktergigigaul.github.io/ocre/Logo-gigital-2.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
          font-family: 'Inter', sans-serif;
      }

      .qr-pattern {
          background-image:
              linear-gradient(45deg, #000 25%, transparent 25%),
              linear-gradient(-45deg, #000 25%, transparent 25%),
              linear-gradient(45deg, transparent 75%, #000 75%),
              linear-gradient(-45deg, transparent 75%, #000 75%);
          background-size: 4px 4px;
          background-position: 0 0, 0 2px, 2px -2px, -2px 0px;
      }

      .animate-pulse-slow {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .fade-in {
          animation: fadeIn 0.5s ease-out;
      }

      .camera-button:active {
          transform: scale(0.95);
      }
    </style>
  </head>

  <body class="bg-white min-h-screen">

    <!-- Main Container - Mobile First Design -->
    <!-- <div class="max-w-lg mx-auto bg-white min-h-screen shadow-lg"> -->
<div class="max-w-lg mx-auto min-h-screen bg-[linear-gradient(to_right,rgba(255,255,255,0.95),rgba(255,255,255,0.95)),url('https://live.staticflickr.com/65535/55106247251_8807839f3b_b.jpg')] bg-cover bg-center">
      <!-- Header with Logo -->
      <div
        class="bg-white px-6 pt-4 backdrop-filter backdrop-blur-md bg-opacity-20"
      >
        <div class="flex items-center gap-2 border-none border-gray-300">
          <!-- QR Logo -->
          <div class="w-12 h-auto rounded-lg">
            <img
              src="https://doktergigigaul.github.io/ocre/Logo-gigital-2.png"
            />
          </div>
          <div class="hidden leading-tight">
                      <p class="text-xs md:text-sm text-gray-600 pb-0 md:pb-1">SRIKANDI</p>
            <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800">Stratifikasi Risiko Kanker Mulut Digital</h1>

          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div id="mainContent" class="p-6">
        <!-- Welcome Screen -->
        <div id="welcomeScreen">
          <!-- Welcome Card -->
          <div class="rounded-xl md:rounded-2xl mb-4 fade-in">
          <p
              class="text-sm text-gray-600 leading-loose tracking-[0.2em] uppercase"
            >
              SRIKANDI
            </p>
            <h2 class=" text-3xl font-extrabold text-gray-900 mb-3 leading-tight">
              Stratifikasi Resiko Kanker Mulut Digital
            </h2>
            <p class="text-normal md:text-lg text-gray-700 mb-4 leading-normal">
              Bot berbasis AI untuk penilaian resiko malignansi dari gambar
              lesi rongga mulut.
            </p>

            <!-- Instructions -->
            <div class="space-y-3">
              <div class="flex items-start gap-2">
                <span class="">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    class="w-6 h-5 text-sky-600"
                    fill="currentColor"
                  >
                    <path
                      d="M12 2C6.477 2 2 6.477 2 12c0 1.821.487 3.53 1.338 5L2 22l5-1.338c1.47.851 3.179 1.338 5 1.338 5.523 0 10-4.477 10-10S17.523 2 12 2z"
                    />

                    <circle cx="12" cy="8" r="1" fill="white" />
                    <path d="M11 11h2v6h-2v-6z" fill="white" />
                  </svg>
                </span>
                <div class="text-normal leading-tight">
                  <p class="font-semibold text-gray-900">Cara Menggunakan:</p>
                </div>
              </div>
              <ol
                class="text-normal text-gray-700 mt-2 pb-0 space-y-1 list-decimal px-6"
              >
                <li>Kirim foto lesi mulut yang jelas</li>
                <li>Tunggu proses analisis</li>
                <li>Terima hasil deteksi dan persentase tingkat kepercayaan</li>
              </ol>
            </div>
          </div>
          
          <!-- Upload Button -->
          <div class="">
          <div class="relative z-10 flex flex-col items-left">
          <p class=" text-sm text-gray-400 mt-2 mb-2">
              Kirim foto dengan klik tombol di bawah ini
            </p>
            <input type="file" id="fileInput" accept="image/*" class="hidden" />
              <button onclick="document.getElementById('fileInput').click()"
                class="hidden mb-6 text-white group relative flex items-left justify-center w-48 h-48 bg-gray-900 rounded-full shadow-lg transition-all duration-300 active:scale-95 hover:bg-sky-600 hover:scale-105 border-[6px] border-white/10 backdrop-blur-sm"
              >
                <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                  clip-rule="evenodd"
                />
              </svg>
              </button>
            </div>
            
            <div class="">
            <input type="file" id="fileInput" accept="image/*" class="hidden" />
            <button
              onclick="document.getElementById('fileInput').click()"
              class="w-62% bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center gap-3 shadow-lg"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                  clip-rule="evenodd"
                />
              </svg>
              <span class="text-lg">Ambil/ Upload Foto</span>
            </button>
            </div>
          </div>

          <!-- Warning Card -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 mb-6 mt-6 fade-in"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1 list-disc pl-4">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena dalam proses
                training AI
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>
        </div>

        <!-- Processing Screen -->
        <div id="processingScreen" class="hidden">
          <!-- Image Preview -->
          <div class="mb-4">
            <img id="imagePreview" class="w-full rounded-2xl" alt="Preview" />
          </div>

          <!-- Upload/Analyze Buttons -->
          <div class="space-y-3">
            <button
              onclick="document.getElementById('fileInput').click()"
              class="w-62% bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-3"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                  clip-rule="evenodd"
                />
              </svg>
              Ambil/ Upload Foto
            </button>
          </div>

          <!-- Processing Status -->
          <div id="processingStatus" class="hidden my-5 text-center">
            <div
              class="inline-flex items-left gap-3 px-6 py-4 rounded-xl w-full"
            >
              <div
                class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"
              ></div>
              <div class="text-left">
                <p class="font-semibold text-gray-900">Menganalisa gambar...</p>
                <p class="text-sm text-gray-600">
                  Harap menunggu. Terimakasih.
                </p>
              </div>
            </div>
          </div>

          <!-- Warning Card (repeated) -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 my-6"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena dalam proses
                training AI
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>
        </div>

        <!-- Result Screen -->
        <div id="resultScreen" class="hidden">
          <!-- Result Image -->
          <div class="mb-4">
            <img id="resultImage" class="w-full rounded-2xl" alt="Result" />
          </div>

          <!-- Result Status Card -->
          <div id="resultCard" class="rounded-2xl py-4 px-6 mb-4">
            <div class="text-left">
              <p class="text-md mb-1">
                <span class="font-bold">Stratifikasi Resiko:</span>
                <span id="statusText" class="font-bold"></span>
              </p>
              <p class="text-md">
                <span class="font-base">Persentase:</span>
                <span id="confidenceText" class="font-base"></span>
              </p>
            </div>
          </div>

          <!-- Recommendation Card -->
          <div class="bg-white rounded-2xl border-none border-gray-200 mb-4">
            <p id="recommendationText" class="text-gray-800 leading-normal"></p>
          </div>

          <!-- Warning Card (repeated) -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 mb-6"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena dalam proses
                training AI
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>

          <!-- New Analysis Button -->
          <button
            onclick="resetApp()"
            class="w-full bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center gap-3 shadow-lg"
          >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                clip-rule="evenodd"
              />
            </svg>
            <span class="text-lg">Penilaian resiko lesi baru</span>
          </button>
        </div>
      </div>
    </div>

    <script>
              // Configuration
              const BACKEND_API_URL = 'https://script.google.com/macros/s/AKfycbzUWjjMNL4ZbTlSFz9lRBe44qXtsXtLaZpab5PMvwQVpCo9SXiB75LnpGVnAtMMnYPenA/exec';

              // AI Model Simulator
              class OralCancerDetector {
                  constructor() {
                      this.modelLoaded = false;
                  }

                  async loadModel() {
                      return new Promise(resolve => {
                          setTimeout(() => {
                              this.modelLoaded = true;
                              resolve();
                          }, 500);
                      });
                  }

                  async predict(imageData) {
                      const response = await fetch('https://web-production-ad57e.up.railway.app/predict', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ image: imageData })
                      });
                      const data = await response.json();
                      return {
                          probability: data.prediction_value,
                          confidence: data.confidence / 100,
                          isCancer: data.diagnosis === 'Cancer Detected'
                      };
                  }
              }

              const detector = new OralCancerDetector();
              let currentImage = null;

              // File Input Handler
              document.getElementById('fileInput').addEventListener('change', async (e) => {
                  const file = e.target.files[0];
                  if (file) {
                      await handleImageUpload(file);
                  }
              });

              async function handleImageUpload(file) {
                  if (file.size > 5 * 1024 * 1024) {
                      alert('Ukuran file terlalu besar! Maksimal 5MB');
                      return;
                  }

                  const reader = new FileReader();
                  reader.onload = async (e) => {
                      currentImage = e.target.result;

                      // Show processing screen
                      document.getElementById('welcomeScreen').classList.add('hidden');
                      document.getElementById('processingScreen').classList.remove('hidden');
                      document.getElementById('imagePreview').src = currentImage;

                      // Show processing status
                      setTimeout(() => {
                          document.getElementById('processingStatus').classList.remove('hidden');
                      }, 500);

                      // Load model if not loaded
                      if (!detector.modelLoaded) {
                          await detector.loadModel();
                      }

                      // Run prediction
                      const result = await detector.predict(currentImage);


                      // Upload to cloud (optional)
                      await uploadToCloud(currentImage, result);

                      // Show results
                      displayResults(result);
                  };
                  reader.readAsDataURL(file);
              }

              function displayResults(result) {
                  const percentage = (result.confidence * 100).toFixed(2);
                  const isCancer = result.isCancer;

                  // Hide processing, show result
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('resultScreen').classList.remove('hidden');
                  document.getElementById('resultImage').src = currentImage;

                  // Result card styling
                  const resultCard = document.getElementById('resultCard');
                  const statusText = document.getElementById('statusText');
                  const confidenceText = document.getElementById('confidenceText');
                  const recommendationText = document.getElementById('recommendationText');

                  if (isCancer) {
                      // KANKER MULUT
                      resultCard.className = 'rounded-2xl p-6 mb-4 bg-red-500 text-white';
                      statusText.textContent = 'KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Segera jadwalkan konsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat untuk memastikan bahwa kondisi yang ada memang berpotensi keganasan';
                  } else {
                      // NON KANKER MULUT
                      resultCard.className = 'rounded-2xl p-6 mb-4 bg-green-600 text-white';
                      statusText.textContent = 'NON KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Pastikan kondisi yang ada tidak berpotensi keganasan. Berkonsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat.';
                  }

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              function getConfidenceLevel(confidence) {
                  if (confidence >= 0.8) return 'Tinggi';
                  if (confidence >= 0.6) return 'Sedang';
                  return 'Rendah';
              }

              async function uploadToCloud(imageData, predictionResult) {
          try {
              const formData = new FormData();
              formData.append('file', imageData);
              formData.append('filename', 'oral_cancer.jpg');
              formData.append('mimeType', 'image/jpeg');
              formData.append('timestamp', new Date().toISOString());
              formData.append('age', '');
              formData.append('gender', '');
              formData.append('prediction', predictionResult ?
                  `${(predictionResult.probability * 100).toFixed(2)}% - ${predictionResult.isCancer ? 'Kanker' : 'Non-Kanker'}` :
                  'Unknown');

              const response = await fetch(BACKEND_API_URL, {
                  method: 'POST',
                  body: formData
              });

              const result = await response.json();
              console.log('Upload result:', result);

              return result;
          } catch (error) {
              console.warn('Upload failed:', error);
              return null;
          }
      }

              function resetApp() {
                  // Reset to welcome screen
                  document.getElementById('resultScreen').classList.add('hidden');
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('welcomeScreen').classList.remove('hidden');
                  document.getElementById('processingStatus').classList.add('hidden');

                  // Clear file input
                  document.getElementById('fileInput').value = '';
                  currentImage = null;

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              // Initialize
              detector.loadModel();
    </script>
  </body>
</html>
