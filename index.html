<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCRE - Oral Cancer Risk Evaluator</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="https://doktergigigaul.github.io/ocre/Logo-gigital-2.png"
    />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .qr-pattern {
            background-image:
                linear-gradient(45deg, #000 25%, transparent 25%),
                linear-gradient(-45deg, #000 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #000 75%),
                linear-gradient(-45deg, transparent 75%, #000 75%);
            background-size: 4px 4px;
            background-position: 0 0, 0 2px, 2px -2px, -2px 0px;
        }

        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .camera-button:active {
            transform: scale(0.95);
        }

        /* ── Gambar hasil upload: selalu kotak, mengisi container ── */
        .result-image {
            display: block;
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 1rem;
        }

      /* ── Gambar hasil upload: selalu kotak, mengisi container ── */
        .result-image {
            display: block;
            width: 100%;          /* ikut lebar container */
            aspect-ratio: 1 / 1;  /* selalu kotak di semua ukuran layar */
            object-fit: cover;    /* crop tengah, tidak gepeng */
            border-radius: 1rem;
        }
      
      /* ── Marquee wrapper: clips overflow ── */
      .marquee-wrapper {
        overflow: hidden;
        width: 100%;
        padding: 8px 0;
      }

      /* ── Inner track: flex row, animates continuously ── */
      .marquee-track {
        display: flex;
        gap: 16px;
        width: max-content;
        animation: marquee-scroll 18s linear infinite;
      }

      /* ── Pause on hover (desktop) ── */
      .marquee-wrapper:hover .marquee-track,
      .marquee-track.paused {
        animation-play-state: paused;
      }

      @keyframes marquee-scroll {
        0%   { transform: translateX(0); }
        100% { transform: translateX(-50%); }
        /* -50% because track = 2× card set, so half = one full loop */
      }

      /* ── Card hover lift ── */
      .slide-card {
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        flex-shrink: 0;
      }
      .slide-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 28px rgba(0,0,0,.18);
      }

      /* ── Floating camera pulse ring ── */
      @keyframes pulse-ring {
        0%   { transform: scale(1);   opacity: .55; }
        70%  { transform: scale(1.5); opacity: 0;   }
        100% { transform: scale(1.5); opacity: 0;   }
      }
      .pulse-ring { position: relative; }
      .pulse-ring::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 9999px;
        background: #2563eb;
        animation: pulse-ring 2s ease-out infinite;
        z-index: -1;
      }
      
/* ── Pulse ring: tombol PILL (persegi panjang rounded) ── */
    @keyframes pulse-ring-pill {
      0%   { opacity: .55; transform: scale(1);    }
      70%  { opacity: 0;   transform: scale(1.05); }
      100% { opacity: 0;   transform: scale(1.05); }
    }
    .pulse-ring-pill { position: relative; z-index: 0; }
    .pulse-ring-pill::before {
      content: '';
      position: absolute;
      inset: -5px;
      border-radius: 16px;
      background: #2563eb;
      animation: pulse-ring-pill 2s ease-out infinite;
      z-index: -1;          /* selalu di belakang — tombol tidak akan hilang */
      pointer-events: none;
    }

    </style>
  </head>

  <body class="bg-gray-100">
    <!-- Single file input, shared by all buttons -->
    <input type="file" id="fileInput" accept="image/*" class="hidden" />
    <!-- Main Container - Mobile First Design -->
    <!-- <div class="max-w-lg mx-auto bg-white min-h-screen shadow-lg"> -->
    <div
      class="max-w-lg md:w-xl mx-auto min-h-screen bg-[linear-gradient(to_right,rgba(255,255,255,0.95),rgba(255,255,255,0.95)),url('https://live.staticflickr.com/65535/55106247251_8807839f3b_b.jpg')] bg-local bg-cover bg-center"
    >
      <!-- Header with Logo -->
      <div class="bg-none px-6 pt-4">
        <div class="flex items-center gap-2 border-none border-gray-300">
          <!-- QR Logo -->
          <div class="w-12 h-auto rounded-lg">
            <img
              src="https://doktergigigaul.github.io/ocre/Logo-gigital-2.png"
            />
          </div>
          <div class="hidden leading-tight">
            <p class="text-xs md:text-sm text-gray-600 pb-0 md:pb-1">
              SRIKANDI
            </p>
            <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800">
              Stratifikasi Risiko Kanker Mulut Digital
            </h1>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div id="mainContent" class="px-6 pb-6 pt-4">
        <!-- Welcome Screen -->
        <div id="welcomeScreen">
          <p
              class="text-sm text-gray-600 leading-loose tracking-[0.2em] uppercase"
            >
              SRIKANDI
            </p>
            <h2
              class="text-3xl font-extrabold text-gray-900 mb-3 leading-tight"
            >
              Skrining Resiko Kanker Mulut: Digital
            </h2>
          <!-- Welcome Card -->
          <div class="rounded-xl md:rounded-2xl mb-4 fade-in">
            
            <p class="text-normal md:text-lg text-gray-700 mb-4 leading-normal">
              Bot berbasis AI untuk penilaian resiko malignansi dari gambar lesi
              rongga mulut.
            </p>

            <!-- ════════════════════════════════
       IMAGE SLIDER – CSS Marquee
  ═══════════════════════════════════ -->
            <section class="my-4 -mx-6">
              <div class="marquee-wrapper">
                <div class="marquee-track" id="marqueeTrack">
                  <!-- ▸ Set 1 (original) -->
                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://media.istockphoto.com/id/1448289724/id/foto/kelenjar-parotis-yang-terinfeksi-infeksi-bakteri-konsep-penyakit-kelenjar-ludah-gondong-kanker.jpg?s=612x612&w=0&k=20&c=d_kPXbi5O4YGFArXS0teEHCvOexdxCz0fVDVA9AbsLA="
                      alt="Non Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-green-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        NON KANKER MULUT
                      </p>
                      <p class="text-green-100 text-xs">Persentase: 87,3%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107498965_b7d5bfb960_n.jpg"
                      alt="Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-red-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        KANKER MULUT
                      </p>
                      <p class="text-red-100 text-xs">Persentase: 97,3%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107377074_a4ab41b2de_n.jpg"
                      alt="Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-red-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        KANKER MULUT
                      </p>
                      <p class="text-red-100 text-xs">Persentase: 81,5%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107380129_604eee8854_n.jpg"
                      alt="Non Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-green-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        NON KANKER MULUT
                      </p>
                      <p class="text-green-100 text-xs">Persentase: 79,8%</p>
                    </div>
                  </div>

                  <!-- ▸ Set 2 (duplicate — membuat loop seamless) -->
                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://media.istockphoto.com/id/1448289724/id/foto/kelenjar-parotis-yang-terinfeksi-infeksi-bakteri-konsep-penyakit-kelenjar-ludah-gondong-kanker.jpg?s=612x612&w=0&k=20&c=d_kPXbi5O4YGFArXS0teEHCvOexdxCz0fVDVA9AbsLA="
                      alt="Non Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-green-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        NON KANKER MULUT
                      </p>
                      <p class="text-green-100 text-xs">Persentase: 87,3%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107498965_b7d5bfb960_n.jpg"
                      alt="Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-red-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        KANKER MULUT
                      </p>
                      <p class="text-red-100 text-xs">Persentase: 97,3%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107377074_a4ab41b2de_n.jpg"
                      alt="Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-red-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        KANKER MULUT
                      </p>
                      <p class="text-red-100 text-xs">Persentase: 81,5%</p>
                    </div>
                  </div>

                  <div
                    class="slide-card w-44 rounded-2xl overflow-hidden shadow-md"
                  >
                    <img
                      src="https://live.staticflickr.com/65535/55107380129_604eee8854_n.jpg"
                      alt="Non Kanker"
                      class="w-full h-32 object-cover"
                    />
                    <div class="bg-green-600 px-3 py-1.5">
                      <p class="text-white font-bold text-xs tracking-wide">
                        NON KANKER MULUT
                      </p>
                      <p class="text-green-100 text-xs">Persentase: 79,8%</p>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Instructions -->
            <div class="space-y-3">
              <div class="flex items-start gap-2">
                <span class="">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    class="w-6 h-5 text-sky-600"
                    fill="currentColor"
                  >
                    <path
                      d="M12 2C6.477 2 2 6.477 2 12c0 1.821.487 3.53 1.338 5L2 22l5-1.338c1.47.851 3.179 1.338 5 1.338 5.523 0 10-4.477 10-10S17.523 2 12 2z"
                    />

                    <circle cx="12" cy="8" r="1" fill="white" />
                    <path d="M11 11h2v6h-2v-6z" fill="white" />
                  </svg>
                </span>
                <div class="text-normal leading-tight">
                  <p class="font-semibold text-gray-900">Cara Menggunakan:</p>
                </div>
              </div>
              <ol
                class="text-normal text-gray-700 mt-2 pb-0 space-y-1 list-decimal px-6"
              >
                <li>Kirim foto lesi mulut yang jelas</li>
                <li>Tunggu proses analisis</li>
                <li>Terima hasil deteksi dan persentase tingkat kepercayaan</li>
              </ol>
            </div>
          </div>

          <!-- Upload Button -->
          <div class="">
            <div class="relative z-10 flex flex-col items-center mx-auto">
              <p class="text-sm text-gray-400 mb-2">
                Klik tombol berikut untuk mulai
              </p>
              <button
                onclick="document.getElementById('fileInput').click()"
                class="hidden mb-6 text-white group relative flex items-left justify-center w-48 h-48 bg-gray-900 rounded-full shadow-lg transition-all duration-300 active:scale-95 hover:bg-sky-600 hover:scale-105 border-[6px] border-white/10 backdrop-blur-sm"
              >
                <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>

            <div class="">
            <!-- ════════════════════════════════
       				FLOATING CAMERA BUTTON
  			   ═══════════════════════════════════
         <input
                type="file"
                id="fileInput"
                accept="image/*"
                class="hidden"
              />
              <button
            id="cameraBtn" onclick="document.getElementById('fileInput').click()"
            class="pulse-ring z-50 w-16 h-16 rounded-full bg-blue-600 text-white shadow-xl flex items-center mx-auto justify-center transition-transform active:scale-90"
          >
            <svg
              class="w-7 h-7 relative z-10"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
              />
              <circle cx="12" cy="13" r="3" stroke-linecap="round" />
            </svg>
          </button> -->
              <button
                onclick="document.getElementById('fileInput').click()"
                class="pulse-ring-pill transition-transform active:scale-95 justify-center mx-auto z-10 w-62% bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center gap-3 shadow-lg"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span class="text-lg">Ambil/ Upload Foto</span>
              </button>
            </div>
          </div>

          <!-- Warning Card -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 mb-6 mt-6 fade-in"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1 list-disc pl-4">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena AI masih dalam proses
                training
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>
        </div>

        <!-- Processing Screen -->
        <div id="processingScreen" class="hidden">
          <!-- Image Preview -->
          <div class="mb-4">
            <img id="imagePreview" class="result-image" alt="Preview" />
          </div>

          <!-- Upload/Analyze Buttons -->
          <div class="space-y-3">
            <button
              onclick="document.getElementById('fileInput').click()"
              class="w-62% bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 flex items-center justify-center mx-auto gap-3"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                  clip-rule="evenodd"
                />
              </svg>
              Ambil/ Upload Foto
            </button>
          </div>

          <!-- Processing Status -->
          <div id="processingStatus" class="hidden my-5 text-center justify-center mx-auto">
            <div
              class="inline-flex items-left gap-4 px-6 py-4 rounded-xl w-full "
            >
              <div
                class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"
              ></div>
              <div class="text-left">
                <p class="font-semibold text-gray-900">Menganalisa gambar...</p>
                <p class="text-sm text-gray-600">
                  Harap menunggu sebentar. Terimakasih.
                </p>
              </div>
            </div>
          </div>

          <!-- Warning Card (repeated) -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 my-6"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena AI masih dalam proses
                training
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>
        </div>

        <!-- Result Screen -->
        <div id="resultScreen" class="hidden">
          <!-- Result Image -->
          <div class="mb-4">
            <img id="resultImage" class="result-image" alt="Result" />
          </div>

          <!-- Result Status Card -->
          <div id="resultCard" class="rounded-2xl py-4 px-6 mb-4">
            <div class="text-left">
              <p class="text-md mb-1">
                <span class="font-bold">Probabilitas:</span>
                <span id="statusText" class="font-bold"></span>
              </p>
              <p class="text-md">
                <span class="font-base">Persentase:</span>
                <span id="confidenceText" class="font-base"></span>
              </p>
            </div>
          </div>

          <!-- Recommendation Card -->
          <div class="bg-none rounded-xl border-none mb-4">
            <p id="recommendationText" class="text-gray-900 leading-normal"></p>
          </div>

          <!-- Warning Card (repeated) -->
          <div
            class="bg-yellow-100 border border-yellow-100 rounded-xl md:rounded-2xl p-6 mb-6"
          >
            <div class="flex items-start gap-2">
              <span class="">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="12"
                  height="24"
                >
                  <path
                    d="M12 2L1 21h22L12 2z"
                    fill="#FFD700"
                    stroke="black"
                    stroke-width="2"
                  />
                  <path d="M11 7h2v7h-2zM11 17h2v2h-2z" fill="black" />
                </svg>
              </span>
              <div>
                <p class="font-bold text-gray-900 mb-2">DISCLAIMER:</p>
              </div>
            </div>
            <ul class="text-sm text-gray-800 space-y-1">
              <li>
                Hasil hanya untuk screening resiko awal, BUKAN pengganti
                diagnosis medis dokter gigi profesional
              </li>
              <li>
                Selalu konsultasi dengan dokter gigi spesialis penyakit mulut
                untuk diagnosis medis akhir
              </li>
              <li>
                Penilaian mungkin menampilkan hasil
                <i>false negative/ false positive</i> karena AI masih dalam proses
                training
              </li>
              <li>
                Hanya untuk digunakan oleh tenaga medis profesional yang
                kompeten
              </li>
            </ul>
          </div>

          <!-- New Analysis Button -->
          <button
            onclick="resetApp()"
            class="w-full bg-sky-500 hover:bg-sky-600 active:bg-sky-700 text-white font-semibold py-4 px-5 rounded-xl transition-all duration-200 camera-button flex items-center justify-center gap-3 shadow-lg"
          >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
                clip-rule="evenodd"
              />
            </svg>
            <span class="text-lg">Penilaian resiko lesi baru</span>
          </button>
        </div>
      </div>
    </div>

    <script>
              // Configuration
              const BACKEND_API_URL = 'https://script.google.com/macros/s/AKfycbzUWjjMNL4ZbTlSFz9lRBe44qXtsXtLaZpab5PMvwQVpCo9SXiB75LnpGVnAtMMnYPenA/exec';

              // AI Model Simulator
              class OralCancerDetector {
                  constructor() {
                      this.modelLoaded = false;
                  }

                  async loadModel() {
                      return new Promise(resolve => {
                          setTimeout(() => {
                              this.modelLoaded = true;
                              resolve();
                          }, 500);
                      });
                  }

                  async predict(imageData) {
                      const response = await fetch('https://web-production-ad57e.up.railway.app/predict', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ image: imageData })
                      });
                      const data = await response.json();
                      return {
                          probability: data.prediction_value,
                          confidence: data.confidence / 100,
                          isCancer: data.diagnosis === 'Cancer Detected'
                      };
                  }
              }

              const detector = new OralCancerDetector();
              let currentImage = null;

              // File Input Handler
              document.getElementById('fileInput').addEventListener('change', async (e) => {
                  const file = e.target.files[0];
                  if (file) {
                      await handleImageUpload(file);
                  }
              });

              async function handleImageUpload(file) {
                  if (file.size > 5 * 1024 * 1024) {
                      alert('Ukuran file terlalu besar! Maksimal 5MB');
                      return;
                  }

                  const reader = new FileReader();
                  reader.onload = async (e) => {
                      currentImage = e.target.result;

                      // Show processing screen
                      document.getElementById('welcomeScreen').classList.add('hidden');
                      document.getElementById('processingScreen').classList.remove('hidden');
                      document.getElementById('imagePreview').src = currentImage;

                      // Show processing status
                      setTimeout(() => {
                          document.getElementById('processingStatus').classList.remove('hidden');
                      }, 500);

                      // Load model if not loaded
                      if (!detector.modelLoaded) {
                          await detector.loadModel();
                      }

                      // Run prediction
                      const result = await detector.predict(currentImage);


                      // Upload to cloud (optional)
                      await uploadToCloud(currentImage, result);

                      // Show results
                      displayResults(result);
                  };
                  reader.readAsDataURL(file);
              }

              function displayResults(result) {
                  const percentage = (result.confidence * 100).toFixed(2);
                  const isCancer = result.isCancer;

                  // Hide processing, show result
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('resultScreen').classList.remove('hidden');
                  document.getElementById('resultImage').src = currentImage;

                  // Result card styling
                  const resultCard = document.getElementById('resultCard');
                  const statusText = document.getElementById('statusText');
                  const confidenceText = document.getElementById('confidenceText');
                  const recommendationText = document.getElementById('recommendationText');

                  if (isCancer) {
                      // KANKER MULUT
                      resultCard.className = 'rounded-2xl p-6 mb-4 bg-red-500 text-white';
                      statusText.textContent = 'KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Segera jadwalkan konsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat untuk memastikan bahwa kondisi yang ada memang berpotensi keganasan';
                  } else {
                      // NON KANKER MULUT
                      resultCard.className = 'rounded-2xl p-6 mb-4 bg-green-600 text-white';
                      statusText.textContent = 'NON KANKER MULUT';
                      confidenceText.textContent = `${percentage}% (${getConfidenceLevel(result.confidence)})`;
                      recommendationText.textContent = 'Pastikan kondisi yang ada tidak berpotensi keganasan. Berkonsultasi ke dokter gigi spesialis penyakit mulut atau dokter gigi terdekat.';
                  }

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              function getConfidenceLevel(confidence) {
                  if (confidence >= 0.8) return 'Tinggi';
                  if (confidence >= 0.6) return 'Sedang';
                  return 'Rendah';
              }

              async function uploadToCloud(imageData, predictionResult) {
          try {
              const formData = new FormData();
              formData.append('file', imageData);
              formData.append('filename', 'oral_cancer.jpg');
              formData.append('mimeType', 'image/jpeg');
              formData.append('timestamp', new Date().toISOString());
              formData.append('age', '');
              formData.append('gender', '');
              formData.append('prediction', predictionResult ?
                  `${(predictionResult.probability * 100).toFixed(2)}% - ${predictionResult.isCancer ? 'Kanker' : 'Non-Kanker'}` :
                  'Unknown');

              const response = await fetch(BACKEND_API_URL, {
                  method: 'POST',
                  body: formData
              });

              const result = await response.json();
              console.log('Upload result:', result);

              return result;
          } catch (error) {
              console.warn('Upload failed:', error);
              return null;
          }
      }

              function resetApp() {
                  // Reset to welcome screen
                  document.getElementById('resultScreen').classList.add('hidden');
                  document.getElementById('processingScreen').classList.add('hidden');
                  document.getElementById('welcomeScreen').classList.remove('hidden');
                  document.getElementById('processingStatus').classList.add('hidden');

                  // Clear file input
                  document.getElementById('fileInput').value = '';
                  currentImage = null;

                  // Scroll to top
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }

              // Initialize
              detector.loadModel();
    </script>

    <!-- ════════════════════════════════
       SLIDER JAVASCRIPT
  ═══════════════════════════════════ -->
    <script>
      const track = document.getElementById('marqueeTrack');

      // Pause on touch (mobile), resume after lift
      track.addEventListener('touchstart', () => track.classList.add('paused'),    { passive: true });
      track.addEventListener('touchend',   () => {
        setTimeout(() => track.classList.remove('paused'), 900);
      }, { passive: true });

      // Camera button action
      document.getElementById('cameraBtn').addEventListener('click', () => {
        document.getElementById('inputFoto').click();
      });
    </script>
  </body>
</html>
